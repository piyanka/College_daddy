name: PR Auto Comment & Label

on:
  pull_request_target:
    types: [opened, closed]

jobs:
  pr_feedback:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write

    steps:
      - name: Add comment when PR is opened
        if: github.event.action == 'opened'
        uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            Thank you for contributing to College Daddy.

            Your pull request has been received and is currently under review.

            Before final approval, please ensure that:

            - You have followed the project's contribution guidelines.

            - Any related issues are linked in the PR description.

            - All changes have been verified locally.

            We appreciate your effort in improving the project. Your contribution helps us build a better experience for students.

      - name: Add PR labels on open
        if: github.event.action == 'opened'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.pull_request.number }},
              labels: ['awaiting review', 'contribution']
            })

      - name: Add thank-you comment when merged
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            üéâ **Your pull request has been successfully merged!**

            Thank you for contributing to College Daddy ‚Äî every improvement helps enhance the platform's experience for students.

            ‚≠ê If you haven't already, please consider starring the repository to support the project and its community.

            üöÄ We look forward to your next contribution! 

      - name: Remove awaiting review label when merged
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            github.rest.issues.removeLabel({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.pull_request.number }},
              name: 'awaiting review'
            })

